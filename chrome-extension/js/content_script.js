(()=>{"use strict";const e=new Map;function t(e){const t=e.getBoundingClientRect(),n=Math.max(document.documentElement.clientHeight,window.innerHeight);return!(t.bottom<0||t.top-n>=0)}let n=!1;setInterval((()=>{n||(n=!0,"https://twitter.com/home"===window.location.href||"https://www.twitter.com/home"===window.location.href?chrome.storage.sync.get(["twitter"]).then((n=>{if(null==n.twitter&&(n.twitter=!0),n.twitter){console.log("Extension running...");const n=document.querySelectorAll("article[data-testid='tweet']"),o=[],s=Array.prototype.filter.call(n,(e=>t(e))),l=[],c=[];for(let t=0;t<s.length;t++){const n=s[t].querySelector("div[data-testid='tweetText']");if(null==n){console.log("[DISCOVERY] fail to find tweet text for "+s[t].textContent.replaceAll("\n","")),o.push("");continue}const r=n.textContent.replaceAll("\n","");o.push(r);const i=s[t].closest("div[data-testid='cellInnerDiv']");!e.has(o[t])&&i&&(i.style.opacity="0.3"),e.has(r)||(l.push(r),c.push(s[t]))}if(0==l.length)return;chrome.storage.sync.get(["preferences","openai_api_key"]).then((t=>{console.log("Preference is "+t.preferences);const n=t.preferences.filter((e=>e.enabled)).map((e=>e.name));console.log("Enabled preferences are "+n);const c={messages:l,preference:n,openai_api_key:t.openai_api_key},r=new XMLHttpRequest;r.open("POST","https://hiubwe6637gmpslsccd4ofi3de0yaeqa.lambda-url.us-east-2.on.aws/"),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(JSON.stringify(c)),console.log("[Backend]","Request sent..."),r.onloadend=function(){const t=JSON.parse(r.responseText);console.log("[BACKEND]",t);for(let n=0;n<t.length;n++)e.set(l[n],t[n]);for(let t=0;t<s.length;t++)e.has(o[t])?e.get(o[t])?(s[t].closest("div[data-testid='cellInnerDiv']").style.opacity="1",console.log("[KEEP] keeping tweet"+s[t].textContent.replaceAll("\n",""))):(s[t].closest("div[data-testid='cellInnerDiv']").style.display="none",console.log("[REMOVE] tweet"+s[t].textContent.replaceAll("\n",""))):console.log("[ERROR] cache does not contain tweet "+l[t])}}))}})):"https://www.zhihu.com/"!==window.location.href&&"https://www.zhihu.com/follow"!==window.location.href||chrome.storage.sync.get(["zhihu"]).then((n=>{if(null==n.zhihu&&(n.zhihu=!0),n.zhihu){console.log("Zhihu extension running...");let n=document.querySelectorAll(".Card.TopstoryItem"),o=[],s=Array.prototype.filter.call(n,(function(e){return t(e)})),l=[],c=[];for(let t=0;t<s.length;t++){let r,i;const a=s[t].querySelector(".ContentItem");if(a&&a.dataset.zop){const e=JSON.parse(a.dataset.zop);r=e.authorName,i=e.title}else i=a.querySelector(".QuestionItem-title").textContent,r="";const p=`Author: ${r}, Title: ${i}, Body: ${a.querySelector(".RichText.ztext").textContent.replaceAll("\n","")}`;console.log(p),o.push(p),e.has(p)||(l.push(p),c.push(n[t]),s[t].style.opacity="0.3")}if(0==l.length)return;chrome.storage.sync.get(["preference","openai_api_key"]).then((t=>{console.log("Value currently is "+t.preference);const n=t.preference,c={messages:l,preference:n,openai_api_key:t.openai_api_key},r=new XMLHttpRequest;r.open("POST","https://hiubwe6637gmpslsccd4ofi3de0yaeqa.lambda-url.us-east-2.on.aws/"),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(JSON.stringify(c)),console.log("[Backend]","Request sent..."),r.onloadend=function(){const t=JSON.parse(r.responseText);console.log("[BACKEND]",t);for(let n=0;n<t.length;n++)e.set(l[n],t[n]);for(let t=0;t<s.length;t++)e.has(o[t])?e.get(o[t])?(s[t].style.opacity="1",console.log("[KEEP] keeping tweet: "+o[t])):(s[t].style.display="none",console.log("[REMOVE] tweet: "+o[t])):console.log("[ERROR] cache does not contain tweet: "+o[t])}}))}})),n=!1)}),3e3)})();